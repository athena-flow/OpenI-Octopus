# 验证子任务命名是否冲突　
# 直接终止任务，State为Failed,这里只验证流程

apiVersion: octopus.openi.pcl.cn/v1alpha1
kind: TaskSet
metadata:
  name: rolenamevalidation
spec:
  retryPolicy:
    retry: false
    maxRetryCount: 1
  roles:
    - name: role1
      replicas: 1
      eventPolicy: 
        - event: RoleSucceeded
          action: TaskSetSucceeded
      completionPolicy:
        maxFailed: 1
        minSucceeded: 1
      retryPolicy:
        retry: false
        maxRetryCount: 1
      template:
        metadata:
          annotations:
            scheduling.k8s.io/group-name: e2e-11
        spec:
          schedulerName: kube-batch
          restartPolicy: Never
          containers:
            - name: worker
              image: busybox
              command: ["sh","-c","sleep 40;exit 0"]
    - name: role1
      replicas: 1
      eventPolicy: 
        - event: RoleFailed
          action: NoAction
      completionPolicy:
        maxFailed: 1
        minSucceeded: 1
      retryPolicy:
        retry: false
        maxRetryCount: 1
      template:
        metadata:
          annotations:
            scheduling.k8s.io/group-name: e2e-11
        spec:
          schedulerName: kube-batch
          restartPolicy: Never
          containers:
            - name: worker
              image: busybox
              command: ["sh","-c","sleep 10;exit 1"]
---
apiVersion: scheduling.incubator.k8s.io/v1alpha1
kind: PodGroup
metadata:
  name: e2e-11
spec:
  minMember: 1