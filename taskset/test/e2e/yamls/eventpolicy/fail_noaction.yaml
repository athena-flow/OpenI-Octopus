# Role2 失败不会导致整体失败，最终任务退出,State 为Succeeded

apiVersion: octopus.openi.pcl.cn/v1alpha1
kind: TaskSet
metadata:
  name: failednoaction
spec:
  retryPolicy:
    retry: false
    maxRetryCount: 1
  roles:
    - name: role1
      replicas: 1
      eventPolicy: 
        - event: RoleSucceeded
          action: TaskSetSucceeded
      completionPolicy:
        maxFailed: 1
        minSucceeded: 1
      retryPolicy:
        retry: false
        maxRetryCount: 1
      template:
        metadata:
          annotations:
            scheduling.k8s.io/group-name: e2e-3
        spec:
          schedulerName: kube-batch
          restartPolicy: Never
          containers:
            - name: worker
              image: busybox
              command: ["sh","-c","sleep 40;exit 0"]
    - name: role2
      replicas: 1
      eventPolicy: 
        - event: RoleFailed
          action: NoAction
      completionPolicy:
        maxFailed: 1
        minSucceeded: 1
      retryPolicy:
        retry: false
        maxRetryCount: 1
      template:
        metadata:
          annotations:
            scheduling.k8s.io/group-name: e2e-3
        spec:
          schedulerName: kube-batch
          restartPolicy: Never
          containers:
            - name: worker
              image: busybox
              command: ["sh","-c","sleep 10;exit 1"]
---
apiVersion: scheduling.incubator.k8s.io/v1alpha1
kind: PodGroup
metadata:
  name: e2e-3
spec:
  minMember: 2